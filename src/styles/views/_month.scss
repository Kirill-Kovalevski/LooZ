/* ===== Month view (clean, centered, mobile-tuned) ===== */

:root{
  /* defaults, will be overridden by Settings via localStorage on boot */
  --task-pill-bg:     #FFE067;
  --task-pill-border: #f3c340;
}

body[data-view='month'] {

  /* Wrapper card (glass + pastel blobs, no overflow) */
  .p-monthview{
    position: relative;
    overflow: hidden;
    isolation: isolate;

    max-inline-size: var(--phone-w, 390px); /* iPhone 12 Pro = 390 */
    margin-inline: auto;
    margin-block: .25rem 1rem;
    padding: .75rem .75rem 1rem;
    border-radius: 16px;

    background: rgba(255,255,255,.86);
    border: 1px solid rgba(100,116,139,.14);
    box-shadow: 0 10px 26px rgba(15,23,42,.08);

    /* 1) Base wash + big soft blobs (static) */
    &::before{
      content:"";
      position:absolute; inset:-12%;
      z-index:-1;
      filter: blur(.5px);
      pointer-events:none;
      background:
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(245,248,255,.08)),
        radial-gradient(38% 38% at 10% 8%,  rgba(255,208,160,.55) 0%, rgba(255,208,160,.20) 40%, rgba(255,208,160,0) 62%),
        radial-gradient(42% 42% at 92% 6%,  rgba(176,206,255,.45) 0%, rgba(176,206,255,.18) 45%, rgba(176,206,255,0) 62%),
        radial-gradient(55% 55% at 100% 55%, rgba(205,180,255,.35) 0%, rgba(205,180,255,.12) 44%, rgba(205,180,255,0) 64%),
        radial-gradient(60% 60% at 0% 100%,  rgba(255,206,170,.36) 0%, rgba(255,206,170,.14) 45%, rgba(255,206,170,0) 70%);
    }

    /* 2) Floating blobs (very subtle motion) */
    &::after{
      content:"";
      position:absolute; inset:-20%;
      z-index:-1;
      filter: blur(28px);
      opacity:.85;
      pointer-events:none;
      background:
        radial-gradient(22% 22% at 18% 25%,  #ffe7b8 0%,  rgba(255,231,184,0) 70%),
        radial-gradient(18% 18% at 78% 22%,  #d6e2ff 0%,  rgba(214,226,255,0) 70%),
        radial-gradient(24% 24% at 78% 78%,  #e2ccff 0%,  rgba(226,204,255,0) 70%),
        radial-gradient(20% 20% at 22% 82%,  #ffd9c0 0%,  rgba(255,217,192,0) 70%);
      animation: pastel-drift 26s ease-in-out infinite alternate;
      will-change: transform, opacity;
    }
  }

  /* Title row (centered) */
  .p-monthhead{
    display: grid; place-items: center;
    margin-block: .35rem .5rem;
    .p-monthtitle{
      text-align:center;
      font: 800 16px/1.2 'Rubik', system-ui, sans-serif;
      color:#0f172a; letter-spacing:.3px;
    }
  }

  /* Weekday bar (one-piece) */
  .p-weekbar{
    display:grid; grid-template-columns:repeat(7, minmax(0,1fr));
    gap:.35rem; margin-bottom:.6rem; direction: rtl; /* Sunday at right for Hebrew */
    background: rgba(255,255,255,.82);
    border: 1px solid #e6eeff; border-radius: 14px; padding: .5rem .35rem;

    .p-wday{ text-align:center; font:700 11px/1.1 system-ui, sans-serif; color:#64748b; }
  }

  /* Grid of dates */
  .p-monthgrid{ display:grid; grid-template-columns:repeat(7, 1fr); gap:.55rem; direction: rtl; }

  /* Date cell */
  .p-cell{
    position:relative; display:grid; place-items:center; aspect-ratio:1 / 1;
    border-radius:16px; border:1px solid #dbe6ff; background: rgba(255,255,255,.88);
    box-shadow:0 3px 10px rgba(15,23,42,.06);
    transition: box-shadow .12s ease, transform .08s ease, border-color .12s ease;
    &:focus-visible{ outline:2px solid #93c5fd; outline-offset:2px; }
  }
  .p-cell__num{ font:800 18px/1 'Rubik', system-ui, sans-serif; color:#0f172a; translate:0 2px; }

  /* Task counter pill â€” ALWAYS read global vars (with fallbacks) */
  .p-count{
    position:absolute; top:-14px; left:50%; translate:-50% 0;
    inline-size:24px; block-size:24px; border-radius:999px;
    display:grid; place-items:center;
    font:800 12px/1 'Rubik', system-ui, sans-serif;
    background: var(--task-pill-bg, #FFE067);
    border: 1px solid var(--task-pill-border, #f3c340);
    color:#0f172a;
    box-shadow:0 3px 8px rgba(15,23,42,.08);
    pointer-events:none; opacity:.92;
  }
  .p-count:not(.has){ opacity:.45; }

  /* Today ring */
  .p-cell--today{ outline:2px solid tomato; outline-offset:-3px; }

  /* Dim filler days */
  .p-cell--dim{ opacity:.45; }

  @media (min-width: 430px){ .p-monthview{ max-inline-size: 430px; } }
}

/* ---- Motion for blobs (disabled for reduced motion) ---- */
@keyframes pastel-drift{
  0%{transform: translate3d(0,0,0) scale(1.00);}
  50%{transform: translate3d(2%, -1%, 0) scale(1.03);}
  100%{transform: translate3d(-2%, 1.5%, 0) scale(1.02);}
}
@media (prefers-reduced-motion: reduce){
  body[data-view='month'] .p-monthview::after{ animation: none; }
}

/* ===== Dark mode ===== */
:is(html,body).is-dark body[data-view='month'] {
  .p-monthview{
    background: rgba(14,18,30,.92);
    border-color: rgba(148,163,184,.18);
    box-shadow: 0 14px 36px rgba(0,0,0,.45);
    &::before{
      background:
        linear-gradient(180deg, rgba(16,20,34,.18), rgba(14,18,30,.14)),
        radial-gradient(38% 38% at 10% 8%,  rgba(255,208,160,.30) 0%, rgba(255,208,160,0) 62%),
        radial-gradient(42% 42% at 92% 6%,   rgba(176,206,255,.28) 0%, rgba(176,206,255,0) 62%),
        radial-gradient(55% 55% at 100% 55%, rgba(205,180,255,.22) 0%, rgba(205,180,255,0) 64%),
        radial-gradient(60% 60% at 0% 100%,  rgba(255,206,170,.24) 0%, rgba(255,206,170,0) 70%);
    }
    &::after{ opacity:.7; }
  }

  .p-monthhead .p-monthtitle{ color:#e6edff; }

  .p-weekbar{
    background: linear-gradient(180deg, #111827, #0b1220);
    border-color:#304469;
    .p-wday{ color:#9bb7df; }
  }

  .p-cell{ border-color:#354a7a; background: rgba(16,24,40,.88); box-shadow:0 3px 14px rgba(6,10,22,.55); }
  .p-cell__num{ color:#e6edff; }

  /* Important: keep using the same CSS vars in dark, too */
  .p-count{
    background: var(--task-pill-bg, #FFE067);
    border: 1px solid var(--task-pill-border, #f3c340);
    color:#0f172a; /* looks good on all our pastels */
    box-shadow:0 4px 12px rgba(0,0,0,.45);
  }

  .p-cell--today{ outline:2px solid tomato; }
}

/* (legacy) remove unused old tokens to avoid confusion
.task-counter{ background: var(--pills-bg); border:1px solid var(--pills-br); }
*/
