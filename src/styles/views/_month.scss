/* ===== Month view (clean, centered, mobile-tuned) ===== */

:root{
  /* defaults (overridable by Settings) */
  --task-pill-bg:     #FFE067;
  --task-pill-border: #f3c340;

  /* sizing tokens (safe for iPhone 12 Pro and above) */
  --month-cell-radius: 16px;
  --month-ring-thickness: 3px;
  --month-gap-x: clamp(6px, 1.6vw, 10px);
  --month-gap-y: clamp(10px, 2.6vw, 14px);
  --month-pill-size: clamp(22px, 5.5vw, 26px);
  --month-pill-clear: 6px;
  --month-num-size: clamp(16px, 4.2vw, 18px);

  /* light cell bg (dark overrides in _dark.scss) */
  --month-cell-bg: rgba(255,255,255,.88);
}

body[data-view='month'] {

  /* Wrapper card (glass + pastel blobs, no overflow) */
  .p-monthview{
    position: relative;
    overflow: hidden;
    isolation: isolate;

    max-inline-size: var(--phone-w, 390px);
    margin-inline: auto;
    margin-block: .25rem 1rem;
    padding: .75rem .75rem 1rem;
    border-radius: 16px;

    background: rgba(255,255,255,.86);
    border: 1px solid rgba(100,116,139,.14);
    box-shadow: 0 10px 26px rgba(15,23,42,.08);

    &::before{
      content:"";
      position:absolute; inset:-12%;
      z-index:-1;
      filter: blur(.5px);
      pointer-events:none;
      background:
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(245,248,255,.08)),
        radial-gradient(38% 38% at 10% 8%,  rgba(255,208,160,.55) 0%, rgba(255,208,160,.20) 40%, rgba(255,208,160,0) 62%),
        radial-gradient(42% 42% at 92% 6%,  rgba(176,206,255,.45) 0%, rgba(176,206,255,.18) 45%, rgba(176,206,255,0) 62%),
        radial-gradient(55% 55% at 100% 55%, rgba(205,180,255,.35) 0%, rgba(205,180,255,.12) 44%, rgba(205,180,255,0) 64%),
        radial-gradient(60% 60% at 0% 100%,  rgba(255,206,170,.36) 0%, rgba(255,206,170,.14) 45%, rgba(255,206,170,0) 70%);
    }

    &::after{
      content:"";
      position:absolute; inset:-20%;
      z-index:-1;
      filter: blur(28px);
      opacity:.85;
      pointer-events:none;
      background:
        radial-gradient(22% 22% at 18% 25%,  #ffe7b8 0%,  rgba(255,231,184,0) 70%),
        radial-gradient(18% 18% at 78% 22%,  #d6e2ff 0%,  rgba(214,226,255,0) 70%),
        radial-gradient(24% 24% at 78% 78%,  #e2ccff 0%,  rgba(226,204,255,0) 70%),
        radial-gradient(20% 20% at 22% 82%,  #ffd9c0 0%,  rgba(255,217,192,0) 70%);
      animation: pastel-drift 26s ease-in-out infinite alternate;
      will-change: transform, opacity;
    }
  }

  /* Title row (centered) */
  .p-monthhead{
    display: grid; place-items: center;
    margin-block: .35rem .5rem;
    .p-monthtitle{
      text-align:center;
      font: 800 16px/1.2 'Rubik', system-ui, sans-serif;
      color:#0f172a; letter-spacing:.3px;
    }
  }

  /* Weekday bar */
  .p-weekbar{
    display:grid; grid-template-columns:repeat(7, minmax(0,1fr));
    column-gap: var(--month-gap-x);
    row-gap: calc(var(--month-gap-y) * .6);
    margin-bottom:.6rem; direction: rtl;
    background: rgba(255,255,255,.82);
    border: 1px solid #e6eeff; border-radius: 14px; padding: .5rem .35rem;

    .p-wday{ text-align:center; font:700 11px/1.1 system-ui, sans-serif; color:#64748b; }
  }

  /* Grid of dates */
  .p-monthgrid{
    display:grid; grid-template-columns:repeat(7, 1fr);
    column-gap: var(--month-gap-x);
    row-gap: calc(var(--month-gap-y) + (var(--month-pill-size) / 2) + var(--month-pill-clear));
    direction: rtl;
  }

  /* Date cell = touch-safe square (≥44px) */
  .p-cell{
    position:relative; display:grid; place-items:center; aspect-ratio:1 / 1;
    min-inline-size: 44px; min-block-size: 44px;
    border-radius: var(--month-cell-radius);
    border:1px solid #dbe6ff;
    background: var(--month-cell-bg);
    box-shadow:0 3px 10px rgba(15,23,42,.06);
    transition: box-shadow .12s ease, transform .08s ease, border-color .12s ease;
    &:focus-visible{ outline:2px solid #93c5fd; outline-offset:2px; }
  }

  .p-cell__num{
    font: 800 var(--month-num-size)/1 'Rubik', system-ui, sans-serif;
    color:#0f172a; translate:0 2px;
  }

  /* Task counter pill — sits on the top edge, halo separates from rings */
  .p-count{
    position:absolute; top:0; left:50%; translate:-50% -50%;
    inline-size: var(--month-pill-size); block-size: var(--month-pill-size); border-radius:999px;
    display:grid; place-items:center;
    font:800 12px/1 'Rubik', system-ui, sans-serif;
    background: var(--task-pill-bg, #FFE067);
    border: 1px solid var(--task-pill-border, #f3c340);
    color:#0f172a;
    box-shadow:
      0 0 0 3px var(--month-cell-bg), /* halo to “erase” overlaps */
      0 3px 8px rgba(15,23,42,.08);
    pointer-events:none; opacity:.92; z-index: 2;
  }
  .p-count:not(.has){
    opacity:1;
    background:#fff; border-color:#cbd5e1; color:#475569; font-weight:800;
  }

  /* TODAY ring = exactly the cell’s size */
  .p-cell--today::after{
    content:"";
    position:absolute; inset:0;
    border-radius: var(--month-cell-radius);
    box-shadow: 0 0 0 var(--month-ring-thickness) #ff5a3c inset;
    pointer-events:none; z-index: 1;
  }

  /* Dim filler days */
  .p-cell--dim{ opacity:.45; }

  @media (min-width: 430px){
    .p-monthview{ max-inline-size: 430px; }
    .p-cell__num{ font-size: clamp(18px, 4vw, 20px); }
    :root{ --month-pill-size: 28px; }
  }
}

/* ---- Motion for blobs (disabled for reduced motion) ---- */
@keyframes pastel-drift{
  0%{transform: translate3d(0,0,0) scale(1.00);}
  50%{transform: translate3d(2%, -1%, 0) scale(1.03);}
  100%{transform: translate3d(-2%, 1.5%, 0) scale(1.02);}
}
@media (prefers-reduced-motion: reduce){
  body[data-view='month'] .p-monthview::after{ animation: none; }
}
