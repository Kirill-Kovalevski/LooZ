/* ===== Month view (clean, centered, mobile-tuned) ===== */

body[data-view='month'] {
  /* Wrapper card */
  .p-monthview {
    max-inline-size: var(--phone-w, 390px); /* iPhone 12 Pro = 390px */
    margin-inline: auto;
    margin-block: .25rem 1rem;
    padding: .75rem .75rem 1rem;
    border-radius: 18px;
    /* subtle translucent pastels */
    border: 1px solid rgba(100,116,139,.14);
    background:
      linear-gradient(180deg, rgba(255,255,255,.86), rgba(247,249,255,.80)) padding-box,
      radial-gradient(120% 140% at 10% -20%, rgba(255,210,180,.12), transparent 55%),
      radial-gradient(120% 140% at 100% 0%, rgba(198,219,255,.14), transparent 60%);
    backdrop-filter: blur(2px);
    box-shadow: 0 10px 26px rgba(15,23,42,.08);
  }

  /* Title row (centered) */
  .p-monthhead {
    display: grid;
    place-items: center;
    margin-block: .25rem .5rem;

    .p-monthtitle {
      text-align: center;
      font: 800 16px/1.2 'Rubik', system-ui, sans-serif;
      color: #0f172a;
      letter-spacing: .3px;
    }
  }

  /* Weekday bar (one-piece) */
  .p-weekbar {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: .35rem;
    margin-bottom: .6rem;
    direction: rtl; /* Sunday at right for Hebrew */
    background: rgba(255,255,255,.82);
    border: 1px solid #e6eeff;
    border-radius: 14px;
    padding: .5rem .35rem;

    .p-wday {
      text-align: center;
      font: 700 11px/1.1 system-ui, sans-serif;
      color: #64748b;
    }
  }

  /* Grid of dates */
  .p-monthgrid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: .55rem;
    direction: rtl; /* Sunday first */
  }

  /* Date cell (square, centered number) */
  .p-cell {
    position: relative;
    display: grid; place-items: center;
    aspect-ratio: 1 / 1;
    border-radius: 16px;
    border: 1px solid #dbe6ff;
    background: rgba(255,255,255,.88);
    box-shadow: 0 3px 10px rgba(15,23,42,.06);
    transition: box-shadow .12s ease, transform .08s ease, border-color .12s ease;

    &:focus-visible { outline: 2px solid #93c5fd; outline-offset: 2px; }
  }

  .p-cell__num {
    font: 800 18px/1 'Rubik', system-ui, sans-serif;
    color: #0f172a;
    translate: 0 2px; /* optical centering */
  }

  /* Top-floating task counter badge â€” gradient fill + matching border */
  .p-count {
    --h: var(--pill-hue, 220); /* set inline by month.js; default 220 (blue) */
    position: absolute;
    top: -12px; left: 50%; translate: -50% 0;
    inline-size: 24px; block-size: 24px;
    border-radius: 999px;
    display: grid; place-items: center;
    font: 800 12px/1 'Rubik', system-ui, sans-serif;
    background: linear-gradient(180deg,
      hsl(var(--h) 100% 95%) 0%,
      hsl(var(--h) 96% 90%) 100%
    );
    border: 1px solid hsl(var(--h) 92% 85%);
    color: #0f172a;
    box-shadow: 0 3px 8px rgba(15,23,42,.08);
    pointer-events: none;
    opacity: .92;
  }
  .p-count:not(.has) { opacity: .45; } /* zero tasks look softer */

  /* Today ring */
  .p-cell--today { box-shadow: 0 0 0 2px color-mix(in oklab, #60a5fa 60%, transparent) inset; }

  /* Dim filler days if any */
  .p-cell--dim { opacity: .45; }

  /* Slightly wider on big phones/tablets */
  @media (min-width: 430px) {
    .p-monthview { max-inline-size: 430px; }
  }
}

/* ===== Dark mode ===== */
:is(html,body).is-dark body[data-view='month'] {
  .p-monthview {
    border-color: rgba(148,163,184,.18);
    background:
      linear-gradient(180deg, rgba(16,20,34,.90), rgba(12,16,26,.86)) padding-box,
      radial-gradient(120% 140% at 8% -20%, rgba(246,202,143,.08), transparent 55%),
      radial-gradient(120% 140% at 100% 0%, rgba(124,164,255,.10), transparent 60%);
    box-shadow: 0 14px 36px rgba(0,0,0,.45);
  }

  .p-monthhead .p-monthtitle { color: #e6edff; }

  .p-weekbar {
    background: linear-gradient(180deg, #111827, #0b1220);
    border-color: #304469;

    .p-wday { color: #9bb7df; }
  }

  .p-cell {
    border-color: #354a7a;
    background: rgba(16,24,40,.88);
    box-shadow: 0 3px 14px rgba(6,10,22,.55);
  }

  .p-cell__num { color: #e6edff; }

  .p-count {
    box-shadow: 0 4px 12px rgba(0,0,0,.45);
    /* same hue, darker border in dark mode */
    border-color: hsl(var(--pill-hue,220) 45% 40%);
  }

  .p-cell--today { box-shadow: 0 0 0 2px color-mix(in oklab, #60a5fa 55%, transparent) inset; }
}
/* Ensure the pastel gradient is always visible and cannot be overridden */
.p-monthview{
  position: relative;
  overflow: hidden;
  border-radius: 16px;
  background: rgba(255,255,255,.86); /* base glass */
  border: 1px solid rgba(100,116,139,.14);
  box-shadow: 0 10px 26px rgba(15,23,42,.08);

  /* pastel gradient layer */
  &::before{
    content:"";
    position:absolute; inset:0;
    background:
      linear-gradient(180deg, rgba(255,255,255,.10), rgba(245,248,255,.08)),
      radial-gradient(120% 140% at 10% -20%, rgba(255,210,180,.16), transparent 55%),
      radial-gradient(120% 140% at 100% 0%, rgba(198,219,255,.18), transparent 60%);
    pointer-events:none;
  }

  .p-monthhead{
    display:grid; place-items:center;
    margin-block:.35rem .5rem;
    .p-monthtitle{
      text-align:center;
      font: 800 16px/1.2 'Rubik', system-ui, sans-serif;
      color:#0f172a;
    }
  }

  .p-weekbar{
    display:grid; grid-template-columns:repeat(7,minmax(0,1fr));
    gap:.35rem; margin-bottom:.35rem;
    .p-wday{
      text-align:center; padding:.35rem 0;
      font:800 12px/1 'Rubik', system-ui; color:#334155;
    }
  }

  .p-monthgrid{
    display:grid; grid-template-columns:repeat(7,minmax(0,1fr));
    gap:.55rem; direction: rtl;
  }

  .p-cell{
    position:relative;
    display:grid; place-items:center;
    aspect-ratio:1/1;
    border-radius:16px;
    border:1px solid #dbe6ff;
    background: rgba(255,255,255,.88);
    box-shadow: 0 3px 10px rgba(15,23,42,.06);
    transition: box-shadow .12s ease, transform .08s ease, border-color .12s ease;

    &:focus-visible{ outline:2px solid #93c5fd; outline-offset:2px; }
  }

  /* TODAY = tomato ring, set slightly inside so it never touches the pill */
  .p-cell--today{
    outline: 2px solid tomato;
    outline-offset: -3px;
  }

  .p-cell__num{
    font:800 18px/1 'Rubik', system-ui; color:#0f172a;
    translate:0 2px;
  }

  /* Blue gradient pill (hue configurable via --pill-hue) */
  .p-count{
    --h: var(--pill-hue, 220);
    position:absolute;
    top:-14px; left:50%; translate:-50% 0;   /* enough air so it doesn't touch the square */
    inline-size:24px; block-size:24px;
    border-radius:999px;
    display:grid; place-items:center;
    font:800 12px/1 'Rubik', system-ui;
    background: linear-gradient(180deg,
      hsl(var(--h) 100% 95%) 0%,
      hsl(var(--h) 96% 90%) 100%);
    border:1px solid hsl(var(--h) 92% 85%);
    color:#0f172a;
    box-shadow:0 3px 8px rgba(15,23,42,.08);
    pointer-events:none;
    opacity:.92;
  }
  .p-count:not(.has){ opacity:.45; }

  .p-cell--dim{ opacity:.55; }
}

/* Dark mode keeps tomato ring and shows darker glass gradient */
:is(html,body).is-dark .p-monthview{
  background: rgba(14,18,30,.92);
  border-color: rgba(148,163,184,.18);
  box-shadow: 0 14px 36px rgba(0,0,0,.45);
  &::before{
    background:
      linear-gradient(180deg, rgba(16,20,34,.18), rgba(14,18,30,.14)),
      radial-gradient(120% 140% at 8% -20%, rgba(246,202,143,.10), transparent 55%),
      radial-gradient(120% 140% at 100% 0%, rgba(124,164,255,.14), transparent 60%);
  }
  .p-cell{ background: rgba(18,23,36,.66); border-color:#354a7a; }
  .p-cell__num{ color:#e6edff; }
  .p-cell--today{ outline:2px solid tomato; }
  .p-count{ box-shadow:0 4px 12px rgba(0,0,0,.45); }
}
